# 결제하기

## 포트원 통합 결제 솔루션

고객사들이 이제 신용카드 뿐만 아니라 간편결제도 같이 원하기 때문에 PG사들도 간편결제들을 "허브형" 형태로 제공한다.

하지만 이 허브형은 직연동보다 제한이 많다. 가령 “포인트 사용 불가”가 있다.

이런 제한없이, 간편결제사들을 직접 각각 이용하면서 연동과 관리를 한곳에서 간편하게 할 수 있도록 존재하는 서비스가 포트원(구: 아임포트)이다.

테스트를 하기에도 적합한 솔루션!

카카오페이로 실습해보자.

---

### 인증결제의 프로세스

1. 결제 요청 (F/E에서 요청)
2. 결제 결과 확인 (F/E에서 결과 받음)
3. 결제 금액 위변조 검증 → B/E로 결제 결과를 전송하면 B/E에서 처리
4. 결제 완료 → B/E에서 성공하면 F/E는 주문 완료 페이지로 이동

### 환경변수의 활용

포트원과 백엔드 서버 주소를 string으로 직접 사용하지 않고

환경변수 .env 를 이용하여 처리한다.

환경변수 세팅이 완료되면 프론트 서버를 껐다가 다시켜줘야 한다.

### 결제 테스트를 위한 프론트 세팅

1. 결제 페이지 생성
2. 포트원의 결제 서비스를 이용할 수 있게 `PaymentService` 를 생성

- API 요청을 관리하기 위해 apiService를 생성한 것과 같은 느낌으로 보면 된다.

3. paymentService를 사용할 수 있도록 `usePayment` hook을 생성

4. 결제 요청

```tsx
const { merchantId, transactionId } = await requestPayment();
```

결제 버튼 클릭시 hook을 이용해서 결제 요청한다.

__결제 결과에 따른 처리__

1. 결제 성공
  
- 백엔드로 주문/결제 정보 결과 전달 (API /orders => createOrder)
- 백엔드에서 완료 응답을 받으면 결제 완료 페이지로 이동

2. 결제 실패

- 이때도 백엔드로 실패했다고 넘겨야 되나???
- 프론트에서 에러 처리 (포트원에서 넘겨주는 에러메시지 그대로 보여줘도 됨)
  
---

🔥 참고사항

- 다른 결제도 연결 해보기
- 관리자 페이지 들어가서 결제 취소 처리도 해보고 많이 테스트 해보기
